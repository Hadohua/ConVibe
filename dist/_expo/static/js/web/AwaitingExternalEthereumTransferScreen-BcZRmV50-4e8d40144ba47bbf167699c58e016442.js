__d(function(g,_r,_i,_a,m,_e2,d){"use strict";Object.defineProperty(_e2,'__esModule',{value:!0}),Object.defineProperty(_e2,"AwaitingExternalEthereumTransferScreen",{enumerable:!0,get:function(){return B}}),Object.defineProperty(_e2,"default",{enumerable:!0,get:function(){return B}});var e,t=_r(d[0]),a=_r(d[1]),n=(e=a)&&e.__esModule?e:{default:e},i=_r(d[2]),r=_r(d[3]),s=_r(d[4]),o=_r(d[5]),c=_r(d[6]),l=_r(d[7]),u=_r(d[8]),h=_r(d[9]),f=_r(d[10]),v=_r(d[11]),p=_r(d[12]),y=_r(d[13]),C=_r(d[14]),b=_r(d[15]),T=_r(d[16]),I=_r(d[17]),w=_r(d[18]),S=_r(d[19]),E=_r(d[20]),x=_r(d[21]),A=_r(d[22]),N=_r(d[23]),F=_r(d[24]),j=_r(d[25]);_r(d[26]),_r(d[27]),_r(d[28]),_r(d[29]),_r(d[30]),_r(d[31]),_r(d[32]),_r(d[33]),_r(d[34]),_r(d[35]),_r(d[36]),_r(d[37]),_r(d[38]),_r(d[39]),_r(d[40]),_r(d[41]),_r(d[42]),_r(d[43]),_r(d[44]),_r(d[45]),_r(d[46]),_r(d[47]),_r(d[48]),_r(d[49]),_r(d[50]),_r(d[51]),_r(d[52]),_r(d[53]),_r(d[54]),_r(d[55]),_r(d[56]),_r(d[57]),_r(d[58]),_r(d[59]),_r(d[60]),_r(d[61]),_r(d[62]),_r(d[63]),_r(d[64]),_r(d[65]),_r(d[66]),_r(d[67]),_r(d[68]),_r(d[69]),_r(d[70]),_r(d[71]),_r(d[72]),_r(d[73]),_r(d[74]),_r(d[75]),_r(d[76]),_r(d[77]);const B={component:()=>{let{rpcConfig:e,appId:a,closePrivyModal:B,createAnalyticsEvent:U}=(0,v.u)(),{navigate:P,setModalData:D,data:_}=(0,y.a)(),M=(0,f.u)(),{wallets:k}=(0,b.u)(),[$,H]=(0,i.useState)(!1),[W,q]=(0,i.useState)(0n),[O,L]=(0,i.useState)(!1),[Q,R]=(0,i.useState)(null),[V,Y]=(0,i.useState)(null),[z,G]=(0,i.useState)([]),[J,K]=(0,i.useState)(0),[X,Z]=(0,i.useState)(!1),[ee,te]=(0,i.useState)(!1),[ae,ne]=(0,i.useState)(!1),[ie,re]=(0,i.useState)(!1),[se,de]=(0,i.useState)(),[oe,ce]=(0,i.useState)();if(!_?.funding||"ethereum"!==_.funding.chainType)throw Error("Invalid funding data");let{erc20ContractInfo:le,chain:ue,connectedWallet:he}=_.funding,fe=_.funding.address,ge=_.funding.erc20Address,[me,ve]=(0,i.useState)(_.funding.amount);(0,i.useEffect)(()=>{ge&&!le&&R(Error("Unable to fetch token details"))},[]);let pe=!!ge&&!!le,ye=pe?BigInt(parseFloat(me)*10**le.decimals):(0,r.parseEther)(me),Ce=("ethereum"===he?.type?he:void 0)??k[0],be=(0,p.Q)(Ce?.walletClientType||"unknown"),Te=be?.name||"wallet",[Ie,we]=(0,i.useState)(null);(0,i.useEffect)(()=>{(async()=>{if(!Ce)return;let e=await Ce.getEthereumProvider();we((0,r.createWalletClient)({account:Ce.address,transport:(0,r.custom)(e)}).extend(r.publicActions))})().catch(console.error)},[Ce]);let[Se,Ee]=(0,i.useState)(0n);(0,i.useEffect)(()=>{(0,r.createPublicClient)({chain:ue,transport:(0,r.http)((0,F.a)(ue,e,a))}).getBalance({address:fe}).then(Ee).catch(console.error)},[]);let[xe,Ae]=(0,i.useState)(0n);(0,i.useEffect)(()=>{pe&&(0,N.g)({chain:ue,address:fe,appId:a,rpcConfig:e,erc20Address:ge}).then(e=>Ae(e.balance)).catch(console.error)},[]);let{tokenPrice:Ne}=(0,C.u)(ue.id),[Fe,je]=(0,i.useState)({to:fe,chain:ue,value:ye,data:void 0});(0,i.useEffect)(()=>{(async()=>{let t,n;if(!Ie||!Ce||X||ae)return;Z(!0);let i=(0,r.createPublicClient)({chain:Fe.chain,transport:(0,r.http)((0,F.a)(Fe.chain,e,a))});if(pe&&!Fe.data)return await i.simulateContract({address:ge,chain:Fe.chain,abi:T.E,functionName:"transfer",args:[fe,ye],account:Ce.address}).catch(e=>{console.warn("Simulated token transfer failed with error, fetching bridge options.",e)})?(Z(!1),void je({to:ge,chain:Fe.chain,data:(0,r.encodeFunctionData)({abi:T.E,functionName:"transfer",args:[fe,ye]}),value:"0x0"})):(Z(!1),void L(!0));try{t=await i.prepareTransactionRequest({account:Ce.address,to:Fe.to,chain:Fe.chain,data:Fe.data,value:BigInt(Fe.value??0)})}catch(t){if(console.error(t),z.length>1)Y(t.shortMessage??"Something went wrong");else if(ee&&0===z.length)return void R(new v.a(`Wallet ${(0,p.D)(Ce.address)} does not have enough funds.`,void 0,v.b.INSUFFICIENT_BALANCE))}if(!t)return Z(!1),void L(!0);Z(!1),ne(!0),H(!0),q(t.gas);try{await Ie.switchChain({id:Fe.chain.id})}catch(t){await Ie.addChain({chain:Fe.chain}),await Ie.switchChain({id:Fe.chain.id})}try{n=await Ie.sendTransaction(t)}catch(t){if(console.error(t),"TransactionExecutionError"===t.name)if(z.length<1){let e=t.shortMessage;(t.shortMessage.includes("rejected the request")||t.details.includes("rejected the request"))&&(e="User rejected the request."),R(new v.a(e,void 0,v.b.TRANSACTION_FAILURE))}else Y(t.shortMessage??"Something went wrong")}if(n)return await Ie.waitForTransactionReceipt({hash:n}),ne(!1),ee?(de(n),void ce("pending")):(re(!0),D((0,x.A)(_,"completed",n,Ce?.walletClientType,pe,le,ue)),void U({eventName:S.O,payload:{provider:"external",status:"success",txHash:n,address:Ce.address,chainId:Fe.chain.id,chainType:"ethereum",value:Fe.value?(0,r.formatUnits)(BigInt(Fe.value),le?.decimals??18):void 0,token:le?.symbol??ge??"ETH",destinationAddress:fe,destinationChainId:ue.id,destinationChainType:"ethereum",destinationValue:ye?(0,r.formatUnits)(ye,le?.decimals??18):void 0,destinationToken:le?.symbol??ge??ue.nativeCurrency.name}}));ne(!1)})().catch(console.error)},[Ie,Fe]),(0,i.useEffect)(()=>{(async()=>{if(!O||!Ie||!Ce)return;let t=(0,s.addToDefaultChains)(M.chains).filter(e=>e.id!==ue.id&&!!e.testnet==!!ue.testnet);pe&&t.unshift(ue);let n=await(0,A.g)({chains:t,address:Ce.address,appId:a,rpcConfig:e,includeUsdc:_.funding?.isUSDC}),i=pe?n.filter(e=>e.balance>0n):n.filter(e=>e.balance>ye),r=pe&&n.every(e=>0n===e.balance);if(i.length<1)return void R(new v.a(r?`Wallet ${(0,p.D)(Ce.address)} doesn't have enough funds to cover gas fees. Top up your wallet and try again.`:`Wallet ${(0,p.D)(Ce.address)} does not have enough funds.`,void 0,v.b.INSUFFICIENT_BALANCE));i.sort((e,t)=>Number(pe?(t.erc20Balance??0n)-(e.erc20Balance??0n):t.balance-e.balance));let o=i.flatMap(e=>{let t=[{...e,isErc20Quote:!1,isTestnet:!!ue.testnet,input:(0,E.t)({appId:a,amount:ye.toString(),user:Ce.address,recipient:fe,destinationChainId:ue.id,destinationCurrency:ge,originChainId:e.chain.id})}];return pe&&ge&&(e.erc20Balance??0n)>=ye&&t.push({...e,isErc20Quote:!0,isTestnet:!!ue.testnet,input:(0,E.t)({appId:a,amount:ye.toString(),user:Ce.address,recipient:fe,destinationChainId:ue.id,destinationCurrency:ge,originChainId:e.chain.id,originCurrency:e.erc20Address})}),t}),c=(await Promise.allSettled(o.map(async e=>({...e,quote:await(0,E.g)(e)})))).filter(e=>"fulfilled"===e.status).map(e=>e.value);if(c.length<1)return void R(new v.a(`Wallet ${(0,p.D)(Ce.address)} does not have enough funds.`,void 0,v.b.INSUFFICIENT_BALANCE));let l=c.map(e=>({bridgeTx:(0,E.c)(e.quote),balance:e.balance,chain:e.chain,erc20Balance:e.erc20Balance,isErc20Quote:e.isErc20Quote})).filter(e=>!!e.bridgeTx);if(l.length>1)return void G(l);let u=l[0];u?(te(!0),je({data:u.bridgeTx.data,to:u.bridgeTx.to,value:u.bridgeTx.value,chain:u.chain})):R(new v.a(`Wallet ${(0,p.D)(Ce.address)} does not have enough funds.`,void 0,v.b.INSUFFICIENT_BALANCE))})().catch(console.error)},[O]),(0,E.u)({transactionHash:se,isTestnet:!!ue.testnet,bridgingStatus:oe,setBridgingStatus:ce,onSuccess({transactionHash:e}){te(!1),re(!0),D((0,x.A)(_,"completed",e,Ce?.walletClientType,pe,le,ue)),U({eventName:S.O,payload:{provider:"external",status:"success",txHash:e,address:Ce?.address,chainId:Fe.chain.id,chainType:"ethereum",value:Fe.value?(0,r.formatUnits)(BigInt(Fe.value),le?.decimals??18):void 0,token:le?.symbol??ge??"ETH",destinationAddress:fe,destinationChainId:ue.id,destinationChainType:"ethereum",destinationValue:ye?(0,r.formatUnits)(ye,le?.decimals??18):void 0,destinationToken:le?.symbol??ge??ue.nativeCurrency.name}})},onFailure({error:e}){te(!1),R(e)}}),(0,i.useEffect)(()=>{Q&&(D({funding:_?.funding,solanaFundingData:_?.solanaFundingData,sendTransaction:_?.sendTransaction,errorModalData:{error:Q,previousScreen:"TransferFromWalletScreen"}}),P("ErrorScreen",!1))},[Q]);let Be=!pe&&Ne?(0,w.c)(me??"0",Ne):void 0,Ue=pe?W:(0,w.s)([W,ye]),Pe=Ue&&Ne?(0,w.a)(Ue,Ne):void 0,De=Ue?(0,w.g)(Ue,_?.funding?.erc20Address?_?.funding?.erc20ContractInfo?.symbol||"ETH":_?.funding?.chain.nativeCurrency.symbol||"ETH"):void 0,_e=W&&Ne?(0,w.a)(W,Ne):void 0,Me=W?(0,w.g)(W,ue?.nativeCurrency?.symbol||"ETH"):void 0;if((0,i.useEffect)(()=>{if(!ie)return;let e=setTimeout(B,f.t);return()=>clearTimeout(e)},[ie]),ie)return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(u.t,{}),(0,t.jsx)(o.b,{}),(0,t.jsxs)(o.c,{children:[(0,t.jsx)(n.default,{color:"var(--privy-color-success)",width:"64px",height:"64px"}),(0,t.jsx)(l.C,{title:"Success!",description:`You\u2019ve successfully added ${me} ${pe?le.symbol:ue.nativeCurrency.symbol} to your ${M.name} wallet. It may take a minute before the funds are available to use.`})]}),(0,t.jsx)(o.R,{}),(0,t.jsx)(c.B,{})]});let ke=pe?`${(0,I.f)({amount:xe,decimals:le.decimals})}  ${le.symbol}`:(0,w.g)(Se,ue.nativeCurrency.symbol,3,!0),$e=z[J];return z.length>1&&$e?(0,t.jsx)(A.B,{displayName:Te,configuredFundingChain:ue,erc20ContractInfo:le,formattedBalance:ke,fundingAmount:me,fundingCurrency:pe?le.symbol:ue.nativeCurrency.symbol,fundingAmountInUsd:Be,options:z,selectedOption:$e,isPreparing:X,isSubmitting:ae,addressToFund:fe,fundingWalletAddress:Ce?.address||"",errorMessage:V,onSubmit:()=>{_.funding?.amount!==me?(async function(){if(Ce&&$e)try{let e=await(0,E.g)({isTestnet:!!ue.testnet,input:(0,E.t)({appId:a,amount:ye.toString(),user:Ce.address,recipient:fe,destinationChainId:ue.id,destinationCurrency:ge,originChainId:$e.chain.id})}),t=(0,E.c)(e);if(!t)throw Error("Invalid transaction request");te(!0),je({data:t.data,to:t.to,value:t.value,chain:$e.chain})}catch(e){console.error(e),R(new v.a("Unable to fetch quotes for bridging",e,v.b.INSUFFICIENT_BALANCE))}})().catch(console.error):je({to:$e.bridgeTx.to,data:$e.bridgeTx.data,value:$e.bridgeTx.value,chain:$e.chain})},onSelect:e=>{e!==J&&(Y(null),K(e))},onAmountChange:ve}):$&&W&&Ce&&_?.funding?(0,t.jsx)(j.T,{walletClientType:Ce?.walletClientType||"unknown",displayName:Te,addressToFund:fe,isBridging:ee,isErc20Flow:pe,totalPriceInUsd:Pe,totalPriceInNativeCurrency:De,gasPriceInUsd:_e,gasPriceInNativeCurrency:Me,chainId:ue.id,chainName:ue.name}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(u.t,{}),(0,t.jsx)(h.N,{}),(0,t.jsx)("div",{style:{marginTop:"1rem"}}),(0,t.jsx)(c.B,{})]})}}},5677,[5,5647,3,792,2129,5648,5246,5649,5650,5251,2509,2511,2523,2508,5651,2622,5678,5671,5672,5653,5654,2128,5658,5659,2621,5674,6277,5247,5248,5249,5250,2510,6275,2524,2537,2539,2293,2540,1019,5652,2310,2164,2623,2295,2683,2686,2689,2690,2691,2692,2900,4618,2341,4620,2132,4621,2326,7827,4873,4874,5244,5660,5643,5661,5662,5663,5664,5665,5655,5666,5667,5668,5669,5670,5673,5675,5676,7957]);