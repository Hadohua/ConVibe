__d(function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,'__esModule',{value:!0});var t=r(d[0]);Object.keys(t).forEach(function(n){'default'===n||Object.prototype.hasOwnProperty.call(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[n]}})})},4267,[4859]);
__d(function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,'__esModule',{value:!0});var t=r(d[0]);Object.keys(t).forEach(function(n){'default'===n||Object.prototype.hasOwnProperty.call(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[n]}})});var n=r(d[1]);Object.keys(n).forEach(function(t){'default'===t||Object.prototype.hasOwnProperty.call(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:function(){return n[t]}})})},4859,[4860,4861]);
__d(function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,'__esModule',{value:!0}),Object.defineProperty(e,"ReownAuthentication",{enumerable:!0,get:function(){return l}});var t=r(d[0]),s=r(d[1]),o=r(d[2]),n=r(d[3]),c=r(d[4]),h=r(d[5]);class l{constructor(s={}){this.otpUuid=null,this.listeners={sessionChanged:[]},this.localAuthStorageKey=s.localAuthStorageKey||t.SafeLocalStorageKeys.SIWX_AUTH_TOKEN,this.localNonceStorageKey=s.localNonceStorageKey||t.SafeLocalStorageKeys.SIWX_NONCE_TOKEN,this.required=s.required??!0,this.messenger=new h.ReownAuthenticationMessenger({getNonce:this.getNonce.bind(this)})}async createMessage(t){return this.messenger.createMessage(t)}async addSession(t){const s=await this.request({method:'POST',key:'authenticate',body:{data:t.data,message:t.message,signature:t.signature,clientId:this.getClientId(),walletInfo:this.getWalletInfo()},headers:['nonce','otp']});this.setStorageToken(s.token,this.localAuthStorageKey),this.emit('sessionChanged',t),this.setAppKitAccountUser(u(s.token)),this.otpUuid=null}async getSessions(t,s){try{if(!this.getStorageToken(this.localAuthStorageKey))return[];const o=await this.request({method:'GET',key:'me',query:{},headers:['auth']});if(!o)return[];const n=o.address.toLowerCase()===s.toLowerCase(),c=o.caip2Network===t;if(!n||!c)return[];const h={data:{accountAddress:o.address,chainId:o.caip2Network},message:'',signature:''};return this.emit('sessionChanged',h),this.setAppKitAccountUser(o),[h]}catch{return[]}}async revokeSession(t,s){return Promise.resolve(this.clearStorageTokens())}async setSessions(t){if(0===t.length)this.clearStorageTokens();else{const s=t.find(t=>t.data.chainId===(0,c.getActiveCaipNetwork)()?.caipNetworkId)||t[0];await this.addSession(s)}}getRequired(){return this.required}async getSessionAccount(){if(!this.getStorageToken(this.localAuthStorageKey))throw new Error('Not authenticated');return this.request({method:'GET',key:'me',body:void 0,query:{includeAppKitAccount:!0},headers:['auth']})}async setSessionAccountMetadata(t=null){if(!this.getStorageToken(this.localAuthStorageKey))throw new Error('Not authenticated');return this.request({method:'PUT',key:'account-metadata',body:{metadata:t},headers:['auth']})}on(t,s){return this.listeners[t].push(s),()=>{this.listeners[t]=this.listeners[t].filter(t=>t!==s)}}removeAllListeners(){Object.keys(this.listeners).forEach(t=>{this.listeners[t]=[]})}async requestEmailOtp({email:t,account:s}){const o=await this.request({method:'POST',key:'otp',body:{email:t,account:s}});return this.otpUuid=o.uuid,this.messenger.resources=[`email:${t}`],o}confirmEmailOtp({code:t}){return this.request({method:'PUT',key:'otp',body:{code:t},headers:['otp']})}async request({method:s,key:o,query:n,body:c,headers:h}){const{projectId:l,st:u,sv:y}=this.getSDKProperties(),S=new URL(`${t.ConstantsUtil.W3M_API_URL}/auth/v1/${String(o)}`);S.searchParams.set('projectId',l),S.searchParams.set('st',u),S.searchParams.set('sv',y),n&&Object.entries(n).forEach(([t,s])=>S.searchParams.set(t,String(s)));const p=await fetch(S,{method:s,body:c?JSON.stringify(c):void 0,headers:Array.isArray(h)?h.reduce((t,s)=>{switch(s){case'nonce':t['x-nonce-jwt']=`Bearer ${this.getStorageToken(this.localNonceStorageKey)}`;break;case'auth':t.Authorization=`Bearer ${this.getStorageToken(this.localAuthStorageKey)}`;break;case'otp':this.otpUuid&&(t['x-otp']=this.otpUuid)}return t},{}):void 0});if(!p.ok)throw new Error(await p.text());return p.headers.get('content-type')?.includes('application/json')?p.json():null}getStorageToken(s){return t.SafeLocalStorage.getItem(s)}setStorageToken(s,o){t.SafeLocalStorage.setItem(o,s)}clearStorageTokens(){this.otpUuid=null,t.SafeLocalStorage.removeItem(this.localAuthStorageKey),t.SafeLocalStorage.removeItem(this.localNonceStorageKey),this.emit('sessionChanged',void 0)}async getNonce(){const{nonce:t,token:s}=await this.request({method:'GET',key:'nonce'});return this.setStorageToken(s,this.localNonceStorageKey),t}getClientId(){return o.BlockchainApiController.state.clientId}getWalletInfo(){const t=n.ChainController.getAccountData()?.connectedWalletInfo;if(!t)return;if('social'in t&&'identifier'in t){return{type:'social',social:t.social,identifier:t.identifier}}const{name:s,icon:o}=t;let c='unknown';switch(t.type){case'EXTERNAL':case'INJECTED':case'ANNOUNCED':c='extension';break;case'WALLET_CONNECT':c='walletconnect';break;default:c='unknown'}return{type:c,name:s,icon:o}}getSDKProperties(){return s.ApiController._getSdkProperties()}emit(t,s){this.listeners[t].forEach(t=>t(s))}setAppKitAccountUser(s){const{email:o}=s;o&&Object.values(t.ConstantsUtil.CHAIN).forEach(t=>{n.ChainController.setAccountProp('user',{email:o},t)})}}function u(t){const s=t.split('.');if(3!==s.length)throw new Error('Invalid token');const o=s[1];if('string'!=typeof o)throw new Error('Invalid token');const n=o.replace(/-/gu,'+').replace(/_/gu,'/'),c=n.padEnd(n.length+(4-n.length%4)%4,'=');return JSON.parse(atob(c))}},4860,[2158,2207,2191,2189,2197,4861]);
__d(function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,'__esModule',{value:!0}),Object.defineProperty(e,"ReownAuthenticationMessenger",{enumerable:!0,get:function(){return o}});var t=r(d[0]),n=r(d[1]);class o{constructor(t){this.getNonce=t.getNonce}async createMessage(t){const n={accountAddress:t.accountAddress,chainId:t.chainId,version:'1',domain:'undefined'==typeof document?'Unknown Domain':document.location.host,uri:'undefined'==typeof document?'Unknown URI':document.location.href,resources:this.resources,nonce:await this.getNonce(t),issuedAt:this.stringifyDate(new Date),statement:void 0,expirationTime:void 0,notBefore:void 0},o={toString:()=>this.stringify(n)};return Object.assign(n,o)}stringify(t){const n=this.getNetworkName(t.chainId);return[`${t.domain} wants you to sign in with your ${n} account:`,t.accountAddress,t.statement?`\n${t.statement}\n`:'',`URI: ${t.uri}`,`Version: ${t.version}`,`Chain ID: ${t.chainId}`,`Nonce: ${t.nonce}`,t.issuedAt&&`Issued At: ${t.issuedAt}`,t.expirationTime&&`Expiration Time: ${t.expirationTime}`,t.notBefore&&`Not Before: ${t.notBefore}`,t.requestId&&`Request ID: ${t.requestId}`,t.resources?.length&&t.resources.reduce((t,n)=>`${t}\n- ${n}`,'Resources:')].filter(t=>'string'==typeof t).join('\n').trim()}getNetworkName(o){const s=n.ChainController.getAllRequestedCaipNetworks();return t.NetworkUtil.getNetworkNameByCaipNetworkId(s,o)}stringifyDate(t){return t.toISOString()}}},4861,[2158,2189]);